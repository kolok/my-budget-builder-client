<template>
  <div class="Content__FormContainer">
    <el-form
      class="Content__Form"
      ref="companyForm"
      :model="companyForm"
      label-width="250px"
    >
      <el-form-item label="Company name">
        <el-input v-model="companyForm.name" />
      </el-form-item>

      <el-form-item label="Fiscal year start month">
        <el-select
          v-model="companyForm.firstMonthFiscalYear"
          placeholder="Select"
        >
          <el-option
            v-for="item in options"
            :key="item.value"
            :label="item.label"
            :value="item.value"
          />
        </el-select>
      </el-form-item>

      <el-form-item label="Currency">
        <el-select
          v-model="companyForm.defaultCurrencyID"
          placeholder="Select a currency"
        >
          <el-option
            v-for="currency in currencies"
            :key="currency.id"
            :label="currency.longName"
            :value="currency.id"
          />
        </el-select>
      </el-form-item>

      <el-form-item
        prop="subdomain"
        label="Pipauls sub-domain"
      >
        <el-input
          v-model="companyForm.subdomain"
          placeholder="subdomain"
          class="Content__Input--Inactive"
          :disabled="true"
        />
        <span class="Content__Text--Suffix">.pipauls.com</span>
      </el-form-item>

      <el-form-item>
        <el-button
          type="primary"
          @click="onSubmit"
        >
          Save
        </el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script>
import CompanyResource from '../../api/company.service'
import { mapActions, mapGetters } from 'vuex'

export default {
  props: {
    'id': {
      type: Number,
      required: true
    }
  },
  data() {
    return {
      'companyForm': {},
      options: [{
        value: '1',
        label: 'January'
      }, {
        value: '2',
        label: 'February'
      }, {
        value: '3',
        label: 'March'
      }, {
        value: '4',
        label: 'April'
      }, {
        value: '5',
        label: 'May'
      }, {
        value: '6',
        label: 'June'
      }, {
        value: '7',
        label: 'July'
      }, {
        value: '8',
        label: 'August'
      }, {
        value: '9',
        label: 'September'
      }, {
        value: '10',
        label: 'October'
      }, {
        value: '11',
        label: 'November'
      }, {
        value: '12',
        label: 'December'
      }],
      value: ''
    }
  },
  computed: {
    ...mapGetters(['currencies'])
  },
  beforeMount(){
    this.getCompany()
  },
  created() {
    this.$store.dispatch('getCurrencies')
  },
  methods: {
    ...mapActions(['updateCompany']),

    getCompany: function() {
      CompanyResource.get(this.id)
        .then(response => {
          this.companyForm = response.data
        })
        .catch(err => {
          this.$Message.error(err.message)
        })
    },
    onSubmit: function() {
      let payload = { _id: this.id, content: this.companyForm }
      this.updateCompany(payload)
        .then(() => {
          const h = this.$createElement
          this.$notify({
            title: 'Company update',
            message: h('i', { style: 'color: teal' }, 'company ' + this.companyForm.name + ' was updated'),
            type: 'success'
          })
        })
        .catch(e => {
          const h = this.$createElement
          this.$notify({
            title: 'Company update',
            message: h('i', { style: 'color: red' }, 'something went wrong, the company wasn\'t updated'),
            type: 'error'
          })
          console.log(e)
        })
    }
  }
}
</script>
